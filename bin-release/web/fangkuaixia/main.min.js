var EndScene=function(e){function t(t){e.call(this),this.init(t)}__extends(t,e);var a=(__define,t);return p=a.prototype,p.init=function(e){this.scene=e,this.width=GameData.getBgWidth(),this.height=GameData.getBgHeight(),this.scene.addChild(this);var t=new egret.Shape;t.graphics.beginFill(0,.5),t.graphics.drawRect(0,0,GameData.getBgWidth(),GameData.getBgHeight()),t.graphics.endFill(),this.addChild(t);var a=new egret.TextField;a.textAlign=egret.HorizontalAlign.CENTER,a.verticalAlign=egret.VerticalAlign.MIDDLE,a.background=!0,a.backgroundColor=16777215,a.border=!0,a.borderColor=0,a.fontFamily="Arial",a.textColor=0,a.size=30,a.text="重新开始",a.width=200,a.height=80,a.x=(GameData.getBgWidth()-a.width)/2,a.y=(GameData.getBgHeight()-a.height)/2,this.addChild(a),a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclikSatrt,this);var i="你用了"+GameData.GameTime+"S通过了"+GameData.lead_index+"个方块",n=new egret.TextField;n.textAlign=egret.HorizontalAlign.CENTER,n.verticalAlign=egret.VerticalAlign.MIDDLE,n.fontFamily="Arial",n.size=30,n.text=i,n.width=GameData.getBgWidth(),n.x=0,n.y=120,this.addChild(n);var s=new egret.Bitmap;s.texture=RES.getRes("arrow"),s.x=GameData.getBgWidth()-50,this.addChild(s);var r=new egret.TextField;r.textAlign=egret.HorizontalAlign.CENTER,r.verticalAlign=egret.VerticalAlign.MIDDLE,r.fontFamily="Arial",r.textColor=16777215,r.size=30,r.text="分享到朋友圈，看看谁是下一个方块侠",r.width=GameData.getBgWidth()-20,r.x=0,r.y=60,this.addChild(r),this.setWeixinShaseCustomInfo()},p.onclikSatrt=function(){var e=RES.getRes("button");e.play(0,1),this.scene.removeChild(this),this.scene.again(),this.scene.gameTime.start(),GameData.GameTime=0,GameData.timerText.text=GameData.GameTime+"s",GameData.obsText.text=GameData.lead_index+"/"+(GameData.Obstacles.length-1)},p.setWeixinShaseCustomInfo=function(){var e="谁是下一个庆安方块侠，我用了"+GameData.GameTime+"S通过了"+GameData.lead_index+"个方块,你也来试试！",t="谁是下一个庆安方块侠，我用了"+GameData.GameTime+"S通过了"+GameData.lead_index+"个方块,你也来试试！",a=new BodyMenuShareAppMessage;a.title=e,a.desc=t,a.link=GameData.link,a.imgUrl=GameData.imgurl,wx.onMenuShareAppMessage(a);var i=new BodyMenuShareQQ;i.title=e,i.desc=t,i.link=GameData.link,i.imgUrl=GameData.imgurl,wx.onMenuShareQQ(i);var n=new BodyMenuShareWeibo;n.title=e,n.desc=t,n.link=GameData.link,n.imgUrl=GameData.imgurl,wx.onMenuShareWeibo(n);var s=new BodyMenuShareTimeline;s.title=e,s.link=GameData.link,s.imgUrl=GameData.imgurl,wx.onMenuShareTimeline(s)},t}(egret.Sprite);egret.registerClass(EndScene,"EndScene");var GameBg=function(e){function t(t,a,i){e.call(this),this.scene=i,this.init(t,a)}__extends(t,e);var a=(__define,t);return p=a.prototype,p.init=function(e,t){var a=new egret.Shape;a.graphics.beginFill(0),a.graphics.drawRect(0,0,GameData.getBgWidth(),GameData.getBgHeight()),a.graphics.endFill(),this.addChild(a),this.bg_w=e,this.bg_h=t,this.column=Math.floor(this.bg_w/GameData.base_w),this.row=Math.floor(this.bg_h/GameData.base_h);for(var i=0;i<this.column;i++)for(var n=0;n<this.row;n++)this.addRect(i*GameData.base_w,GameData.getBgHeight()-(n+1)*GameData.base_h)},p.addRect=function(e,t){var a=new egret.Shape;a.graphics.beginFill(13421772),a.graphics.drawRect(e,t,GameData.base_w,GameData.base_h),a.graphics.endFill(),this.addChild(a)},t}(egret.Sprite);egret.registerClass(GameBg,"GameBg");var GameData=function(){function e(){}var t=(__define,e);return p=t.prototype,e.getBgWidth=function(){return 0==e.bgWidth&&(e.bgWidth=egret.MainContext.instance.stage.stageWidth),e.bgWidth},e.getBgHeight=function(){return 0==e.bgHeight&&(e.bgHeight=egret.MainContext.instance.stage.stageHeight),e.bgHeight},e.random=function(e,t){return Math.floor(e+Math.random()*(t-e))},e.initTimerText=function(t){e.timerText=new egret.TextField,e.timerText.textAlign=egret.HorizontalAlign.CENTER,e.timerText.verticalAlign=egret.VerticalAlign.MIDDLE,e.timerText.fontFamily="Arial",e.timerText.textColor=16711680,e.timerText.size=40,e.timerText.text="",e.timerText.width=80,e.timerText.height=80,e.timerText.x=0,e.timerText.y=0,t.addChild(e.timerText)},e.initObsText=function(t){e.obsText=new egret.TextField,e.obsText.textAlign=egret.HorizontalAlign.CENTER,e.obsText.verticalAlign=egret.VerticalAlign.MIDDLE,e.obsText.fontFamily="Arial",e.obsText.textColor=16711680,e.obsText.size=40,e.obsText.text="",e.obsText.width=160,e.obsText.height=80,e.obsText.x=120,e.obsText.y=0,t.addChild(e.obsText)},e.base_w=20,e.base_h=20,e.bgWidth=0,e.bgHeight=0,e.Obstacles=new Array,e.gamebg_w=6e3,e.gamebg_h=480,e.obstacle_w=4,e.obstacle_h=8,e.obstacle_range=8,e.lead_index=0,e.lead_w=2,e.lead_h=2,e.stick_w=1,e.stick_base_h=1,e.game_state=0,e.b_touch=!1,e.lead_move_step=0,e.base_tween_time=200,e.wait_time=200,e.tween_time=300,e.timer_time=200,e.end_state=0,e.Touch=1,e.LeadMove=2,e.SceneMove=3,e.StickMove=4,e.Death=5,e.Start=6,e.End=7,e.Victory=8,e.b_life=!1,e.game_timer_time=1e3,e.GameTime=0,e.game_name="庆安方块侠",e.start_tips="作为庆安人考验下你对长度的预估能力，红色方块为主角，黑色方块为柱子，你所要做的就是预判两者之间空隙的长度，然后通过点击屏幕再松开在前进的道路上铺出一条棍桥使其通过，棍子的长度不能太长或太短，否则都会掉进深渊。",e.link="http://mp.weixin.qq.com/s?__biz=MzA5MTQ2NjQ2MA==&mid=400587491&idx=1&sn=c24b92a0dfe624692abd7eca78cd491a",e.imgurl=location.href.split("#")[0]+"/resource/assets/logo32.png",e}();egret.registerClass(GameData,"GameData");var GameScene=function(e){function t(){e.call(this),this.init()}__extends(t,e);var a=(__define,t);return p=a.prototype,p.init=function(){this.x=0,this.y=0,this.width=GameData.getBgWidth(),this.height=GameData.getBgHeight();var e=new GameBg(GameData.gamebg_w,GameData.gamebg_h,this);this.addChild(e),this.addObstacle(),this.addStick(),this.addLead(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touch,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touch,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.touch,this),this.timer=new egret.Timer(GameData.timer_time,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.start(),GameData.game_state=GameData.Start,this.startScene=new StartScene(this),this.gameTime=new egret.Timer(GameData.game_timer_time,0),this.gameTime.addEventListener(egret.TimerEvent.TIMER,this.gameTimerFunc,this)},p.addObstacle=function(){for(var e=Math.floor(GameData.gamebg_w/GameData.base_w),t=Math.floor(e/GameData.obstacle_range),a=0;t>a;a++){var i=a*GameData.obstacle_range+GameData.random(0,GameData.obstacle_range-GameData.obstacle_w);new Obstacle(i,this)}},p.addLead=function(){GameData.b_life=!0;var e=GameData.Obstacles[GameData.lead_index];this.lead=new Lead(e.index_x+(GameData.obstacle_w-GameData.lead_w)/2,this)},p.addStick=function(){var e=GameData.Obstacles[GameData.lead_index];this.stick=new Stick(e.index_x+(GameData.obstacle_w-GameData.stick_w),this)},p.growStick=function(){this.stick.grow()},p.touch=function(e){if(GameData.game_state==GameData.Touch)switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:GameData.b_touch=!0;break;case egret.TouchEvent.TOUCH_MOVE:GameData.b_touch=!0;break;case egret.TouchEvent.TOUCH_END:GameData.b_touch=!1,this.stick.rotate()}},p.timerFunc=function(){GameData.b_touch&&this.growStick()},p.gameTimerFunc=function(){GameData.GameTime+=1,GameData.timerText.text=GameData.GameTime+"s"},p.moveLead=function(){var e=GameData.Obstacles[GameData.lead_index],t=GameData.Obstacles[GameData.lead_index+1],a=t.index_x-e.index_x-GameData.obstacle_w-this.stick.getRow();0>=a&&a>=-GameData.obstacle_w?(GameData.lead_move_step=t.index_x-e.index_x,GameData.lead_index==GameData.Obstacles.length-2?(GameData.b_life=!1,GameData.end_state=1):GameData.b_life=!0):(GameData.lead_move_step=this.stick.getRow()+(GameData.obstacle_w-GameData.lead_w)/2,GameData.b_life=!1,GameData.end_state=2),this.lead.move()},p.resetStick=function(){GameData.lead_index+=1;var e=GameData.Obstacles[GameData.lead_index];this.stick.reset(e.index_x+(GameData.obstacle_w-GameData.stick_w))},p.moveScene=function(){var e=GameData.lead_move_step*GameData.base_w,t=this.x-e;if(t<-(GameData.gamebg_w-GameData.getBgWidth()))t=-(GameData.gamebg_w-GameData.getBgWidth());else{var a=RES.getRes("stick_grow_loop");a.play(0,3)}egret.Tween.get(this,{loop:!1,onChange:this.onChange,onChangeObj:this}).to({x:t},GameData.tween_time).wait(GameData.wait_time).call(this.onComplete,this)},p.onChange=function(){},p.onComplete=function(){GameData.game_state=GameData.Touch},p.endgame=function(){this.gameTime.stop();var e=RES.getRes("score");e.play(0,1),GameData.game_state=GameData.End,this.endScene=new EndScene(this),this.endScene.x=-this.x,GameData.timerText.text="",GameData.obsText.text=""},p.again=function(){this.x=0;for(var e=0;e<GameData.Obstacles.length;e++){var t=GameData.Obstacles[e];this.removeChild(t)}GameData.Obstacles=new Array,GameData.lead_index=0,this.removeChild(this.stick),this.removeChild(this.lead),this.addObstacle(),this.addStick(),this.addLead(),GameData.game_state=GameData.Touch},t}(egret.Sprite);egret.registerClass(GameScene,"GameScene");var Lead=function(e){function t(t,a){e.call(this),this.index_x=t,this.scene=a,this.init(t,a)}__extends(t,e);var a=(__define,t);return p=a.prototype,p.init=function(e,t){this.x=e*GameData.base_w,this.y=GameData.getBgHeight()-GameData.obstacle_h*GameData.base_h-GameData.lead_h*GameData.base_h;for(var a=0;a<GameData.lead_w;a++)for(var i=0;i<GameData.lead_h;i++){var n=new egret.Shape;n.graphics.beginFill(16711680),n.graphics.drawRect(a*GameData.base_w,i*GameData.base_h,GameData.base_w,GameData.base_h),n.graphics.endFill(),this.addChild(n)}t.addChild(this)},p.move=function(){var e=this.x+GameData.lead_move_step*GameData.base_w,t=GameData.lead_move_step*GameData.base_tween_time,a=RES.getRes("kick");a.play(0,GameData.lead_move_step-1),egret.Tween.get(this,{loop:!1,onChange:this.onChange,onChangeObj:this}).to({x:e},t).wait(500).call(this.onComplete,this)},p.onChange=function(){},p.onComplete=function(){GameData.b_life?(GameData.game_state=GameData.SceneMove,this.scene.resetStick(),this.scene.moveScene(),GameData.obsText.text=GameData.lead_index+"/"+(GameData.Obstacles.length-1)):1==GameData.end_state?(GameData.game_state=GameData.Victory,this.victory()):(GameData.game_state=GameData.Death,this.death())},p.death=function(){var e=RES.getRes("death");e.play(0,1),egret.Tween.get(this,{loop:!1,onChange:this.onDeathChange,onChangeObj:this}).to({y:GameData.getBgHeight()},GameData.tween_time).wait(GameData.wait_time).call(this.onDeathComplete,this)},p.onDeathChange=function(){},p.onDeathComplete=function(){this.scene.endgame()},p.victory=function(){var e=RES.getRes("victory");e.play(0,1),egret.Tween.get(this,{loop:!1,onChange:this.onDeathChange,onChangeObj:this}).to({scaleX:2,scaleY:2},GameData.tween_time).wait(GameData.wait_time).call(this.onDeathComplete,this)},p.onVictoryChange=function(){},p.onVictoryComplete=function(){this.scene.endgame()},t}(egret.Sprite);egret.registerClass(Lead,"Lead");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var a=(__define,t);return p=a.prototype,p.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},p.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this._isDebug=!1,this.url="http://www.baoguangguang.cn/wxgame?url="+encodeURIComponent(location.href.split("#")[0]),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var a=(__define,t);return p=a.prototype,p.onAddToStage=function(){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},p.onConfigComplete=function(){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},p.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.createGameScene())},p.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},p.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},p.createGameScene=function(){var e=new GameScene;this.addChild(e),GameData.initTimerText(this),GameData.initObsText(this),this.getSignPackage();location.href.split("#")[0]+"/resource/assets/logo32.png"},p.createBitmapByName=function(e){var t=new egret.Bitmap,a=RES.getRes(e);return t.texture=a,t},p.startAnimation=function(e){for(var t=this,a=new egret.HtmlTextParser,i=[],n=0;n<e.length;n++)i.push(a.parser(e[n]));var s=t.textfield,r=-1,h=function(){r++,r>=i.length&&(r=0);var e=i[r];t.changeDescription(s,e);var a=egret.Tween.get(s);a.to({alpha:1},200),a.wait(2e3),a.to({alpha:0},200),a.call(h,t)};h()},p.changeDescription=function(e,t){e.textFlow=t},p.getSignPackage=function(){var e=this,t=new egret.URLLoader,a=new egret.URLRequest(this.url);t.load(a),a.method=egret.URLRequestMethod.GET,t.addEventListener(egret.Event.COMPLETE,function(t){e.signPackage=JSON.parse(t.target.data),e.getWeiXinConfig()},this)},p.getWeiXinConfig=function(){var e=new BodyConfig;e.debug=!1,e.appId=this.signPackage.appId,e.timestamp=this.signPackage.timestamp,e.nonceStr=this.signPackage.nonceStr,e.signature=this.signPackage.signature,e.jsApiList=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"],wx.config(e),wx.ready(function(){wx.checkJsApi({jsApiList:["chooseImage","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"],success:function(){}})}),wx.error(function(){}),this.setWeixinShaseInfo()},p.setWeixinShaseInfo=function(){var e="看看谁能最快的通过所有障碍，成为庆安方块侠",t="看看谁能最快的通过所有障碍，成为庆安方块侠",a=new BodyMenuShareAppMessage;a.title=e,a.desc=t,a.link=GameData.link,a.imgUrl=GameData.imgurl,wx.onMenuShareAppMessage(a);var i=new BodyMenuShareQQ;i.title=e,i.desc=t,i.link=GameData.link,i.imgUrl=GameData.imgurl,wx.onMenuShareQQ(i);var n=new BodyMenuShareWeibo;n.title=e,n.desc=t,n.link=GameData.link,n.imgUrl=GameData.imgurl,wx.onMenuShareWeibo(n);var s=new BodyMenuShareTimeline;s.title=e,s.link=GameData.link,s.imgUrl=GameData.imgurl,wx.onMenuShareTimeline(s)},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Obstacle=function(e){function t(t,a){e.call(this),this.body=a,this.index_x=t,this.init(t),GameData.Obstacles.push(this)}__extends(t,e);var a=(__define,t);return p=a.prototype,p.init=function(e){this.x=e*GameData.base_w,this.y=GameData.getBgHeight()-GameData.obstacle_h*GameData.base_h,this.drawObstacle()},p.drawObstacle=function(){for(var e=0;e<GameData.obstacle_w;e++)for(var t=0;t<GameData.obstacle_h;t++){var a=new egret.Shape;a.graphics.beginFill(0),a.graphics.drawRect(e*GameData.base_w,t*GameData.base_h,GameData.base_w,GameData.base_h),a.graphics.endFill(),this.addChild(a)}this.body.addChild(this)},t}(egret.Sprite);egret.registerClass(Obstacle,"Obstacle");var StartScene=function(e){function t(t){e.call(this),this.init(t)}__extends(t,e);var a=(__define,t);return p=a.prototype,p.init=function(e){this.scene=e,this.width=GameData.getBgWidth(),this.height=GameData.getBgHeight(),this.scene.addChild(this);var t=new egret.Shape;t.graphics.beginFill(0,.5),t.graphics.drawRect(0,0,GameData.getBgWidth(),GameData.getBgHeight()),t.graphics.endFill(),this.addChild(t);var a=new egret.TextField;a.textAlign=egret.HorizontalAlign.CENTER,a.size=30,a.text=GameData.start_tips,a.width=GameData.getBgWidth()-20,a.x=10,a.y=40,this.addChild(a);var i=new egret.TextField;i.textAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,i.background=!0,i.backgroundColor=16777215,i.border=!0,i.borderColor=0,i.fontFamily="Arial",i.textColor=0,i.size=30,i.text="开始游戏",i.width=140,i.height=60,i.x=(GameData.getBgWidth()-i.width)/2,i.y=(GameData.getBgHeight()-i.height)/2,this.addChild(i),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclikSatrt,this)},p.onclikSatrt=function(){var e=RES.getRes("button");e.play(0,1),this.scene.removeChild(this),this.scene.gameTime.start(),GameData.game_state=GameData.Touch,GameData.GameTime=0,GameData.timerText.text=GameData.GameTime+"s",GameData.obsText.text=GameData.lead_index+"/"+(GameData.Obstacles.length-1)},t}(egret.Sprite);egret.registerClass(StartScene,"StartScene");var Stick=function(e){function t(t,a){e.call(this),this.scene=a,this.index_x=t,this.init(t,a)}__extends(t,e);var a=(__define,t);return p=a.prototype,p.init=function(e,t){this.row=GameData.stick_base_h,this.x=e*GameData.base_w+GameData.base_w,this.y=GameData.getBgHeight()-GameData.obstacle_h*GameData.base_h+GameData.stick_base_h*GameData.base_h,this.rect=new egret.Shape,t.addChild(this),this.drawShape()},p.drawShape=function(){this.rect.graphics.clear();for(var e=0;e<this.row;e++)this.rect.graphics.beginFill(6710835),this.rect.graphics.drawRect(0,e*GameData.base_h,GameData.base_w,GameData.base_h),this.rect.graphics.endFill(),this.addChild(this.rect);this.anchorOffsetX=this.width,this.anchorOffsetY=this.height},p.grow=function(){var e=RES.getRes("stick_grow_loop");e.play(0,1),this.row+=1,this.y=GameData.getBgHeight()-GameData.obstacle_h*GameData.base_h+GameData.stick_base_h*GameData.base_h,this.drawShape()},p.rotate=function(){GameData.game_state=GameData.StickMove;var e=new egret.Shape;e.graphics.beginFill(16776960),e.graphics.drawRect(0,0,this.width,this.height),e.graphics.endFill(),egret.Tween.get(this,{loop:!1,onChange:this.onChange,onChangeObj:this}).to({rotation:90},GameData.tween_time).wait(GameData.wait_time).call(this.onComplete,this)},p.onChange=function(){},p.onComplete=function(){var e=RES.getRes("kick");e.play(0,1),GameData.game_state=GameData.LeadMove,this.scene.moveLead()},p.getRow=function(){return this.row},p.reset=function(e){this.row=GameData.stick_base_h,this.rotation=0,this.x=e*GameData.base_w+GameData.base_w,this.y=GameData.getBgHeight()-GameData.obstacle_h*GameData.base_h+GameData.stick_base_h*GameData.base_h,this.drawShape()},t}(egret.Sprite);egret.registerClass(Stick,"Stick");